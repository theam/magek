<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Instrumentation | Magek Framework</title><meta name="description" content="Documentation for Magek Framework"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><link rel="stylesheet" href="../assets/custom.css"/><script defer src="../assets/main.js"></script><script defer src="../assets/custom.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">Magek Framework</a><div id="tsd-toolbar-links"><a href="https://github.com/theam/magek">GitHub</a><a href="https://magek.ai">Website</a></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="Documentation.html">Documentation</a></li><li><a href="" aria-current="page">Instrumentation</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="magek-instrumentation" class="tsd-anchor-link">Magek instrumentation<a href="#magek-instrumentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><h2 id="trace-decorator" class="tsd-anchor-link">Trace Decorator<a href="#trace-decorator" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Trace Decorator is a <strong>Magek</strong> functionality that facilitates the reception of notifications whenever significant events occur in Magek's core, such as event dispatching or migration execution.</p>
<h3 id="usage" class="tsd-anchor-link">Usage<a href="#usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To configure a custom tracer, you need to define an object with two methods: onStart and onEnd. The onStart method is called before the traced method is invoked, and the onEnd method is called after the method completes. Both methods receive a TraceInfo object, which contains information about the traced method and its arguments.</p>
<p>Here's an example of a custom tracer that logs trace events to the console:</p>
<pre><code class="typescript"><span class="hl-6">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">TraceParameters</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">MagekConfig</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">TraceActionTypes</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@magek/common&#39;</span><br/><br/><span class="hl-3">class</span><span class="hl-1"> </span><span class="hl-7">MyTracer</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">static</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-0">onStart</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">: </span><span class="hl-7">MagekConfig</span><span class="hl-1">, </span><span class="hl-4">actionType</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-4">traceParameters</span><span class="hl-1">: </span><span class="hl-7">TraceParameters</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Start </span><span class="hl-3">${</span><span class="hl-4">actionType</span><span class="hl-3">}</span><span class="hl-2">: </span><span class="hl-3">${</span><span class="hl-4">traceParameters</span><span class="hl-11">.</span><span class="hl-4">className</span><span class="hl-3">}</span><span class="hl-2">.</span><span class="hl-3">${</span><span class="hl-4">traceParameters</span><span class="hl-11">.</span><span class="hl-4">methodName</span><span class="hl-3">}</span><span class="hl-2">`</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-3">static</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-0">onEnd</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">: </span><span class="hl-7">MagekConfig</span><span class="hl-1">, </span><span class="hl-4">actionType</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-4">traceParameters</span><span class="hl-1">: </span><span class="hl-7">TraceParameters</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`End </span><span class="hl-3">${</span><span class="hl-4">actionType</span><span class="hl-3">}</span><span class="hl-2">: </span><span class="hl-3">${</span><span class="hl-4">traceParameters</span><span class="hl-11">.</span><span class="hl-4">className</span><span class="hl-3">}</span><span class="hl-2">.</span><span class="hl-3">${</span><span class="hl-4">traceParameters</span><span class="hl-11">.</span><span class="hl-4">methodName</span><span class="hl-3">}</span><span class="hl-2">`</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>You can then configure the tracer in your Magek application's configuration:</p>
<pre><code class="typescript"><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-8">config</span><span class="hl-1">: </span><span class="hl-7">MagekConfig</span><span class="hl-1"> = {</span><br/><span class="hl-5">// ...other configuration options...</span><br/><span class="hl-1">  </span><span class="hl-4">trace:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">enableTraceNotification:</span><span class="hl-1"> </span><span class="hl-3">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">onStart:</span><span class="hl-1"> </span><span class="hl-4">MyTracer</span><span class="hl-1">.</span><span class="hl-4">onStart</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">onEnd:</span><span class="hl-1"> </span><span class="hl-4">MyTracer</span><span class="hl-1">.</span><span class="hl-4">onStart</span><span class="hl-1">,</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>In the configuration above, we've enabled trace notifications and specified our onStart and onEnd as the methods to use. Verbose disable will reduce the amount of information generated excluding the internal parameter in the trace parameters.</p>
<p>Setting <code>enableTraceNotification: true</code> would enable the trace for all actions. You can either disable them by setting it to <code>false</code> or selectively enable only specific actions using an array of TraceActionTypes.</p>
<pre><code class="typescript"><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-8">config</span><span class="hl-1">: </span><span class="hl-7">MagekConfig</span><span class="hl-1"> = {</span><br/><span class="hl-5">// ...other configuration options...</span><br/><span class="hl-1">  </span><span class="hl-4">trace:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">enableTraceNotification:</span><span class="hl-1"> [</span><span class="hl-4">TraceActionTypes</span><span class="hl-1">.</span><span class="hl-8">DISPATCH_EVENT</span><span class="hl-1">, </span><span class="hl-4">TraceActionTypes</span><span class="hl-1">.</span><span class="hl-8">MIGRATION_RUN</span><span class="hl-1">, </span><span class="hl-2">&#39;OTHER&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">includeInternal:</span><span class="hl-1"> </span><span class="hl-3">false</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">onStart:</span><span class="hl-1"> </span><span class="hl-4">MyTracer</span><span class="hl-1">.</span><span class="hl-4">onStart</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">onEnd:</span><span class="hl-1"> </span><span class="hl-4">MyTracer</span><span class="hl-1">.</span><span class="hl-4">onStart</span><span class="hl-1">,</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>In this example, only DISPATCH_EVENT, MIGRATION_RUN and 'OTHER' actions will trigger trace notifications.</p>
<h3 id="traceactiontypes" class="tsd-anchor-link">TraceActionTypes<a href="#traceactiontypes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The TraceActionTypes enum defines all the traceable actions in Magek's core:</p>
<pre><code class="typescript"><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-3">enum</span><span class="hl-1"> </span><span class="hl-7">TraceActionTypes</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-8">CUSTOM</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">EVENT_HANDLERS_PROCESS</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">HANDLE_EVENT</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">DISPATCH_ENTITY_TO_EVENT_HANDLERS</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">DISPATCH_EVENTS</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">FETCH_ENTITY_SNAPSHOT</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">STORE_SNAPSHOT</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">LOAD_LATEST_SNAPSHOT</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">LOAD_EVENT_STREAM_SINCE</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">ENTITY_REDUCER</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">READ_MODEL_FIND_BY_ID</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">GRAPHQL_READ_MODEL_SEARCH</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">READ_MODEL_SEARCH</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">COMMAND_HANDLER</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">MIGRATION_RUN</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">GRAPHQL_DISPATCH</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">GRAPHQL_RUN_OPERATION</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">SCHEDULED_COMMAND_HANDLER</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">DISPATCH_SUBSCRIBER_NOTIFIER</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">READ_MODEL_SCHEMA_MIGRATOR_RUN</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">SCHEMA_MIGRATOR_MIGRATE</span><span class="hl-1">,</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="traceinfo" class="tsd-anchor-link">TraceInfo<a href="#traceinfo" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The TraceInfo interface defines the data that is passed to the tracer's onBefore and onAfter methods:</p>
<pre><code class="typescript"><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-3">interface</span><span class="hl-1"> </span><span class="hl-7">TraceInfo</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">className</span><span class="hl-1">: </span><span class="hl-7">string</span><br/><span class="hl-1">  </span><span class="hl-4">methodName</span><span class="hl-1">: </span><span class="hl-7">string</span><br/><span class="hl-1">  </span><span class="hl-4">args</span><span class="hl-1">: </span><span class="hl-7">Array</span><span class="hl-1">&lt;</span><span class="hl-7">unknown</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-4">traceId</span><span class="hl-1">: </span><span class="hl-7">UUID</span><br/><span class="hl-1">  </span><span class="hl-4">elapsedInvocationMillis</span><span class="hl-1">?: </span><span class="hl-7">number</span><br/><span class="hl-1">  </span><span class="hl-4">internal</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-4">target</span><span class="hl-1">: </span><span class="hl-7">unknown</span><br/><span class="hl-1">    </span><span class="hl-4">descriptor</span><span class="hl-1">: </span><span class="hl-7">PropertyDescriptor</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-4">description</span><span class="hl-1">?: </span><span class="hl-7">string</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><code>className</code> and <code>methodName</code> identify the function that is being traced.</p>
<h3 id="adding-the-trace-decorator-to-your-own-async-methods" class="tsd-anchor-link">Adding the Trace Decorator to Your own async methods<a href="#adding-the-trace-decorator-to-your-own-async-methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>In addition to using the Trace Decorator to receive notifications when events occur in Magek's core, you can also use it to trace your own methods. To add the Trace Decorator to your own methods, simply add @Trace() before your method declaration.</p>
<p>Here's an example of how to use the Trace Decorator on a custom method:</p>
<pre><code class="typescript"><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-3">class</span><span class="hl-1"> </span><span class="hl-7">MyCustomClass</span><span class="hl-1"> {</span><br/><span class="hl-1">  @</span><span class="hl-0">Trace</span><span class="hl-1">(</span><span class="hl-2">&#39;OTHER&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-3">public</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-0">myCustomMethod</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">: </span><span class="hl-7">MagekConfig</span><span class="hl-1">, </span><span class="hl-4">logger</span><span class="hl-1">: </span><span class="hl-7">Logger</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">debug</span><span class="hl-1">(</span><span class="hl-2">&#39;This is my custom method&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-5">// Do some custom logic here...</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>In the example above, we added the @Trace('OTHER') decorator to the myCustomMethod method. This will cause the method to emit trace events when it's invoked, allowing you to trace the flow of your application and detect performance bottlenecks or errors.</p>
<p>Note that when you add the Trace Decorator to your own methods, you'll need to configure your Magek instance to use a tracer that implements the necessary methods to handle these events.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#magek-instrumentation"><span>Magek instrumentation</span></a><ul><li><a href="#trace-decorator"><span>Trace <wbr/>Decorator</span></a></li><li><ul><li><a href="#usage"><span>Usage</span></a></li><li><a href="#traceactiontypes"><span>Trace<wbr/>Action<wbr/>Types</span></a></li><li><a href="#traceinfo"><span>Trace<wbr/>Info</span></a></li><li><a href="#adding-the-trace-decorator-to-your-own-async-methods"><span>Adding the <wbr/>Trace <wbr/>Decorator to <wbr/>Your own async methods</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/theam/magek" class="tsd-nav-link">GitHub</a><a href="https://magek.ai" class="tsd-nav-link">Website</a></nav><nav class="tsd-navigation"><a href="../index.html">Magek Framework</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
