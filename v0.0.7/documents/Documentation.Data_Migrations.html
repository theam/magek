<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Data Migrations | Magek Framework</title><meta name="description" content="Documentation for Magek Framework"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><link rel="stylesheet" href="../assets/custom.css"/><script defer src="../assets/main.js"></script><script defer src="../assets/custom.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">Magek Framework</a><div id="tsd-toolbar-links"><a href="https://github.com/theam/magek">GitHub</a></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="Documentation.html">Documentation</a></li><li><a href="" aria-current="page">Data Migrations</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="migrations" class="tsd-anchor-link">Migrations<a href="#migrations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Migrations are a mechanism for updating or transforming the schemas of events and entities as your system evolves. This allows you to make changes to your data model without losing or corrupting existing data. There are two types of migration tools available in Magek: schema migrations and data migrations.</p>
<ul>
<li>
<p><strong>Schema migrations</strong> are used to incrementally upgrade an event or entity from a past version to the next. They are applied lazily, meaning that they are performed on-the-fly whenever an event or entity is loaded. This allows you to make changes to your data model without having to manually update all existing artifacts, and makes it possible to apply changes without running lengthy migration processes.</p>
</li>
<li>
<p><strong>Data migrations</strong>, on the other hand, behave as background processes that can actively change the existing values in the database for existing entities and read models. They are particularly useful for data migrations that cannot be performed automatically with schema migrations, or for updating existing read models after a schema change.</p>
</li>
</ul>
<p>Together, schema and data migrations provide a flexible and powerful toolset for managing the evolution of your data model over time.</p>
<h2 id="schema-migrations" class="tsd-anchor-link">Schema migrations<a href="#schema-migrations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Magek handles classes annotated with <code>@SchemaMigration</code> as <strong>schema migrations</strong>. The migration functions defined inside will update an existing artifact (either an event or an entity) from a previous version to a newer one whenever that artifact is visited. Schema migrations are applied to events and entities lazily, meaning that they are only applied when the event or entity is loaded. This ensures that the migration process is non-disruptive and does not affect the performance of your system. Schema migrations are also performed on-the-fly and the results are not written back to the database, as events are not revisited once the next snapshot is written in the database.</p>
<p>For example, to upgrade a <code>Product</code> entity from version 1 to version 2, you can write the following migration class:</p>
<pre><code class="typescript"><span class="hl-1">@</span><span class="hl-0">SchemaMigration</span><span class="hl-1">(</span><span class="hl-4">Product</span><span class="hl-1">)</span><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-3">class</span><span class="hl-1"> </span><span class="hl-7">ProductMigration</span><span class="hl-1"> {</span><br/><span class="hl-1">  @</span><span class="hl-0">toVersion</span><span class="hl-1">(</span><span class="hl-9">2</span><span class="hl-1">, { </span><span class="hl-4">fromSchema:</span><span class="hl-1"> </span><span class="hl-4">ProductV1</span><span class="hl-1">, </span><span class="hl-4">toSchema:</span><span class="hl-1"> </span><span class="hl-4">ProductV2</span><span class="hl-1"> })</span><br/><span class="hl-1">  </span><span class="hl-3">public</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-0">changeNameFieldToDisplayName</span><span class="hl-1">(</span><span class="hl-4">old</span><span class="hl-1">: </span><span class="hl-7">ProductV1</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">ProductV2</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">ProductV2</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">sku</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">name</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">description</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">price</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">pictures</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">deleted</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Notice that we've used the <code>@toVersion</code> decorator in the above example. This decorator not only tells Magek what schema upgrade this migration performs, it also informs it about the existence of a version, which is always an integer number. Magek will always use the latest version known to tag newly created artifacts, defaulting to 1 when no migrations are defined. This ensures that the schema of newly created events and entities is up-to-date and that they can be migrated as needed in the future.</p>
<p>The <code>@toVersion</code> decorator takes two parameters in addition to the version: <code>fromSchema</code> and <code>toSchema</code>. The fromSchema parameter is set to <code>ProductV1</code>, while the <code>toSchema</code> parameter is set to <code>ProductV2</code>. This tells Magek that the migration is updating the <code>Product</code> object from version 1 (as defined by the <code>ProductV1</code> schema) to version 2 (as defined by the <code>ProductV2</code> schema).</p>
<p>As Magek can easily read the structure of your classes, the schemas are described as plain classes that you can maintain as part of your code. The <code>ProductV1</code> class represents the schema of the previous version of the <code>Product</code> object with the properties and structure of the <code>Product</code> object as it was defined in version 1. The <code>ProductV2</code> class is an alias for the latest version of the Product object. You can use the <code>Product</code> class here, there's no difference, but it's a good practice to create an alias for clarity.</p>
<p>It's a good practice to define the schema classes (<code>ProductV1</code> and <code>ProductV2</code>) as non-exported classes in the same migration file. This allows you to see the changes made between versions and helps to understand how the migration works:</p>
<pre><code class="typescript"><span class="hl-3">class</span><span class="hl-1"> </span><span class="hl-7">ProductV1</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">public</span><span class="hl-1"> </span><span class="hl-3">constructor</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-3">public</span><span class="hl-1"> </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-7">UUID</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">readonly</span><span class="hl-1"> </span><span class="hl-4">sku</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">readonly</span><span class="hl-1"> </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">readonly</span><span class="hl-1"> </span><span class="hl-4">description</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">readonly</span><span class="hl-1"> </span><span class="hl-4">price</span><span class="hl-1">: </span><span class="hl-7">Money</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">readonly</span><span class="hl-1"> </span><span class="hl-4">pictures</span><span class="hl-1">: </span><span class="hl-7">Array</span><span class="hl-1">&lt;</span><span class="hl-7">Picture</span><span class="hl-1">&gt;,</span><br/><span class="hl-1">    </span><span class="hl-3">public</span><span class="hl-1"> </span><span class="hl-4">deleted</span><span class="hl-1">: </span><span class="hl-7">boolean</span><span class="hl-1"> = </span><span class="hl-3">false</span><br/><span class="hl-1">  ) {}</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">class</span><span class="hl-1"> </span><span class="hl-7">ProductV2</span><span class="hl-1"> </span><span class="hl-3">extends</span><span class="hl-1"> </span><span class="hl-7">Product</span><span class="hl-1"> {}</span>
</code><button type="button">Copy</button></pre>

<p>When you want to upgrade your artifacts from V2 to V3, you can add a new function decorated with <code>@toVersion</code> to the same migrations class. You're free to structure the code the way you want, but we recommend keeping all migrations for the same artifact in the same migration class. For instance:</p>
<pre><code class="typescript"><span class="hl-1">@</span><span class="hl-0">SchemaMigration</span><span class="hl-1">(</span><span class="hl-4">Product</span><span class="hl-1">)</span><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-3">class</span><span class="hl-1"> </span><span class="hl-7">ProductMigration</span><span class="hl-1"> {</span><br/><span class="hl-1">  @</span><span class="hl-0">toVersion</span><span class="hl-1">(</span><span class="hl-9">2</span><span class="hl-1">, { </span><span class="hl-4">fromSchema:</span><span class="hl-1"> </span><span class="hl-4">ProductV1</span><span class="hl-1">, </span><span class="hl-4">toSchema:</span><span class="hl-1"> </span><span class="hl-4">ProductV2</span><span class="hl-1"> })</span><br/><span class="hl-1">  </span><span class="hl-3">public</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-0">changeNameFieldToDisplayName</span><span class="hl-1">(</span><span class="hl-4">old</span><span class="hl-1">: </span><span class="hl-7">ProductV1</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">ProductV2</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">ProductV2</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">sku</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">name</span><span class="hl-1">, </span><span class="hl-5">// It&#39;s now called `displayName`</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">description</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">price</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">pictures</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">deleted</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  @</span><span class="hl-0">toVersion</span><span class="hl-1">(</span><span class="hl-9">3</span><span class="hl-1">, { </span><span class="hl-4">fromSchema:</span><span class="hl-1"> </span><span class="hl-4">ProductV2</span><span class="hl-1">, </span><span class="hl-4">toSchema:</span><span class="hl-1"> </span><span class="hl-4">ProductV3</span><span class="hl-1"> })</span><br/><span class="hl-1">  </span><span class="hl-3">public</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-0">addNewField</span><span class="hl-1">(</span><span class="hl-4">old</span><span class="hl-1">: </span><span class="hl-7">ProductV2</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">ProductV3</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">ProductV3</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">sku</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">displayName</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">description</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">price</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">pictures</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">old</span><span class="hl-1">.</span><span class="hl-4">deleted</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-9">42</span><span class="hl-1"> </span><span class="hl-5">// We set a default value to initialize this field</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>In this example, the <code>changeNameFieldToDisplayName</code> function updates the <code>Product</code> entity from version 1 to version 2 by renaming the <code>name</code> field to <code>displayName</code>. Then, <code>addNewField</code> function updates the <code>Product</code> entity from version 2 to version 3 by adding a new field called <code>newField</code> to the entity's schema. Notice that at this point, your database could have snapshots set as v1, v2, or v3, so while it might be tempting to redefine the original migration to keep a single 1-to-3 migration, it's usually a good idea to keep the intermediate steps. This way Magek will be able to handle any scenario.</p>
<h2 id="data-migrations" class="tsd-anchor-link">Data migrations<a href="#data-migrations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Data migrations can be seen as background processes that can actively update the values of existing entities and read models in the database. They can be useful to perform data migrations that cannot be handled with schema migrations, for example when you need to update the values exposed by the GraphQL API, or to initialize new read models that are projections of previously existing entities.</p>
<p>To create a data migration in Magek, you can use the <code>@DataMigration</code> decorator on a class that implements a <code>start</code> method. The <code>@DataMigration</code> decorator takes an object with a single parameter, <code>order</code>, which specifies the order in which the data migration should be run relative to other data migrations.</p>
<p>Data migrations are not run automatically, you need to invoke the <code>MagekDataMigrations.run()</code> method from an event handler or a command. This will emit a <code>MagekDataMigrationStarted</code> event, which will make Magek check for any pending migrations and run them in the specified order. A common pattern to be able to run migrations on demand is to add a special command, with access limited to an administrator role which calls this function.</p>
<p>It's advisable to design these functions in a way that allows re-running them in case of failures. In order to tell Magek that your migration has been applied successfully, at the end of each <code>DataMigration.start</code> method, you must emit a <code>MagekDataMigrationFinished</code> event manually.</p>
<p>Inside your <code>@DataMigration</code> classes, you can use the <code>MagekDataMigrations.migrateEntity</code> method to update the data for a specific entity. This method takes the old entity name, the old entity ID, and the new entity data as arguments. It will also generate an internal <code>MagekEntityMigrated</code> event before performing the migration.</p>
<p>Here is an example of how you might use the <code>@DataMigration</code> decorator and the <code>Magek.migrateEntity</code> method to update the quantity of the first item in a cart:</p>
<pre><code class="typescript"><span class="hl-1">@</span><span class="hl-0">DataMigration</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">order:</span><span class="hl-1"> </span><span class="hl-9">2</span><span class="hl-1">,</span><br/><span class="hl-1">})</span><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-3">class</span><span class="hl-1"> </span><span class="hl-7">CartIdDataMigrateV2</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">public</span><span class="hl-1"> </span><span class="hl-3">constructor</span><span class="hl-1">() {}</span><br/><br/><span class="hl-1">  </span><span class="hl-3">public</span><span class="hl-1"> </span><span class="hl-3">static</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-0">start</span><span class="hl-1">(</span><span class="hl-4">register</span><span class="hl-1">: </span><span class="hl-7">Register</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-8">entitiesIdsResult</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Magek</span><span class="hl-1">.</span><span class="hl-0">entitiesIDs</span><span class="hl-1">(</span><span class="hl-2">&#39;Cart&#39;</span><span class="hl-1">, </span><span class="hl-9">500</span><span class="hl-1">, </span><span class="hl-3">undefined</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-8">paginatedEntityIdResults</span><span class="hl-1"> = </span><span class="hl-4">entitiesIdsResult</span><span class="hl-1">.</span><span class="hl-4">items</span><br/><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-8">carts</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">paginatedEntityIdResults</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-3">async</span><span class="hl-1"> (</span><span class="hl-4">entity</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Magek</span><span class="hl-1">.</span><span class="hl-0">entity</span><span class="hl-1">(</span><span class="hl-4">Cart</span><span class="hl-1">, </span><span class="hl-4">entity</span><span class="hl-1">.</span><span class="hl-4">entityID</span><span class="hl-1">))</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-4">carts</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-3">async</span><span class="hl-1"> (</span><span class="hl-4">cart</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">cart</span><span class="hl-1">.</span><span class="hl-4">cartItems</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-4">quantity</span><span class="hl-1"> = </span><span class="hl-9">100</span><br/><span class="hl-1">          </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-8">newCart</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Cart</span><span class="hl-1">(</span><span class="hl-4">cart</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">cart</span><span class="hl-1">.</span><span class="hl-4">cartItems</span><span class="hl-1">, </span><span class="hl-4">cart</span><span class="hl-1">.</span><span class="hl-4">shippingAddress</span><span class="hl-1">, </span><span class="hl-4">cart</span><span class="hl-1">.</span><span class="hl-4">checks</span><span class="hl-1">)</span><br/><span class="hl-1">          </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">MagekDataMigrations</span><span class="hl-1">.</span><span class="hl-0">migrateEntity</span><span class="hl-1">(</span><span class="hl-2">&#39;Cart&#39;</span><span class="hl-1">, </span><span class="hl-4">validCart</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">newCart</span><span class="hl-1">)</span><br/><span class="hl-1">          </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">validCart</span><span class="hl-1">.</span><span class="hl-4">id</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    )</span><br/><br/><span class="hl-1">    </span><span class="hl-4">register</span><span class="hl-1">.</span><span class="hl-0">events</span><span class="hl-1">(</span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">MagekDataMigrationFinished</span><span class="hl-1">(</span><span class="hl-2">&#39;CartIdDataMigrateV2&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h1 id="migrate-from-previous-magek-versions" class="tsd-anchor-link">Migrate from Previous Magek Versions<a href="#migrate-from-previous-magek-versions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><ul>
<li>To migrate to new versions of Magek, check that you have the latest development dependencies required:</li>
</ul>
<pre><code class="json"><span class="hl-2">&quot;devDependencies&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;rimraf&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;^5.0.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;@typescript-eslint/eslint-plugin&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;4.22.1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;@typescript-eslint/parser&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;4.22.1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;eslint&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;7.26.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;eslint-config-prettier&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;8.3.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;eslint-plugin-prettier&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;3.4.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;mocha&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;10.2.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;@types/mocha&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;10.0.1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;nyc&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;15.1.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;prettier&quot;</span><span class="hl-1">:  </span><span class="hl-2">&quot;2.3.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;typescript&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;4.5.4&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;ts-node&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;9.1.1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;@types/node&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;15.0.2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;ts-patch&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;3.1.2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;@magek/metadata&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;0.30.2&quot;</span><br/><span class="hl-1">  },</span>
</code><button type="button">Copy</button></pre>

<h2 id="migrate-to-magek-version-1190" class="tsd-anchor-link">Migrate to Magek version 1.19.0<a href="#migrate-to-magek-version-1190" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Magek version 1.19.0 requires updating your index.ts file to export the <code>health</code> method. If you have an index.ts file created from a previous Magek version, update it accordingly. Example:</p>
<pre><code class="typescript"><span class="hl-6">export</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">Magek</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">eventDispatcher</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">graphQLDispatcher</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">health</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">notifySubscribers</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">triggerScheduledCommands</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@magek/core&#39;</span><br/><br/><span class="hl-4">Magek</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">(</span><span class="hl-4">__dirname</span><span class="hl-1">)</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#migrations"><span>Migrations</span></a><ul><li><a href="#schema-migrations"><span>Schema migrations</span></a></li><li><a href="#data-migrations"><span>Data migrations</span></a></li></ul><a href="#migrate-from-previous-magek-versions"><span>Migrate from <wbr/>Previous <wbr/>Magek <wbr/>Versions</span></a><ul><li><a href="#migrate-to-magek-version-1190"><span>Migrate to <wbr/>Magek version 1.19.0</span></a></li></ul></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/theam/magek" class="tsd-nav-link">GitHub</a></nav><nav class="tsd-navigation"><a href="../index.html">Magek Framework</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
